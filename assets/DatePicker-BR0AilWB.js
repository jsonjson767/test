import{y as H,a0 as Ce,R as Y,ad as te,z as A,D as L,ae as q,af as z,m as M,ag as Re,U as V,T as ue,C as Z,ah as Fe,$ as de,j as h,G as De,ai as ce,Q as W,E as N,O as Oe,A as _e,aj as ze,Y as R,ak as F,ab as Ae,Z as ve,al as ie,a3 as me,am as Ue,H as ne,an as Te,ao as he,ap as je,aq as Ke,ar as Pe,as as Le,b as Me,at as We,S as ge,au as Ze,av as qe,aw as Ge,ax as Qe,P as Ve,I as Ie,_ as Je,a8 as Xe,a as et,a9 as tt,o as G,c as Q,w as pe,a7 as nt,d as j,t as K,e as B,i as ot,F as at,f as lt,n as st}from"./index-CmcWA7_w.js";import"./index-uLk6m4Sh.js";import{C as ct}from"./index-CAPVbmIe.js";import{d as ae}from"./dayjs.min-CxMP4GVf.js";import{u as it}from"./use-id-Bi58DoCp.js";const[rt,E,ye]=H("picker"),Se=e=>e.find(o=>!o.disabled)||e[0];function ut(e,o){const t=e[0];if(t){if(Array.isArray(t))return"multiple";if(o.children in t)return"cascade"}return"default"}function ee(e,o){o=te(o,0,e.length);for(let t=o;t<e.length;t++)if(!e[t].disabled)return t;for(let t=o-1;t>=0;t--)if(!e[t].disabled)return t;return 0}const be=(e,o,t)=>o!==void 0&&!!e.find(c=>c[t.value]===o);function re(e,o,t){const c=e.findIndex(s=>s[t.value]===o),a=ee(e,c);return e[a]}function dt(e,o,t){const c=[];let a={[o.children]:e},s=0;for(;a&&a[o.children];){const m=a[o.children],x=t.value[s];if(a=Ce(x)?re(m,x,o):void 0,!a&&m.length){const f=Se(m)[o.value];a=re(m,f,o)}s++,c.push(m)}return c}function mt(e){const{transform:o}=window.getComputedStyle(e),t=o.slice(7,o.length-1).split(", ")[5];return Number(t)}function ft(e){return Y({text:"text",value:"value",children:"children"},e)}const we=200,xe=300,vt=15,[Ee,le]=H("picker-column"),$e=Symbol(Ee);var ht=A({name:Ee,props:{value:L,fields:q(Object),options:z(),readonly:Boolean,allowHtml:Boolean,optionHeight:q(Number),swipeDuration:q(L),visibleOptionNum:q(L)},emits:["change","clickOption","scrollInto"],setup(e,{emit:o,slots:t}){let c,a,s,m,x;const f=M(),C=M(),p=M(0),y=M(0),_=Re(),O=()=>e.options.length,b=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,d=g=>{let n=ee(e.options,g);const r=-n*e.optionHeight,v=()=>{n>O()-1&&(n=ee(e.options,g));const $=e.options[n][e.fields.value];$!==e.value&&o("change",$)};c&&r!==p.value?x=v:v(),p.value=r},w=()=>e.readonly||!e.options.length,P=g=>{c||w()||(x=null,y.value=we,d(g),o("clickOption",e.options[g]))},i=g=>te(Math.round(-g/e.optionHeight),0,O()-1),k=V(()=>i(p.value)),l=(g,n)=>{const r=Math.abs(g/n);g=p.value+r/.003*(g<0?-1:1);const v=i(g);y.value=+e.swipeDuration,d(v)},u=()=>{c=!1,y.value=0,x&&(x(),x=null)},D=g=>{if(!w()){if(_.start(g),c){const n=mt(C.value);p.value=Math.min(0,n-b())}y.value=0,a=p.value,s=Date.now(),m=a,x=null}},T=g=>{if(w())return;_.move(g),_.isVertical()&&(c=!0,De(g,!0));const n=te(a+_.deltaY.value,-(O()*e.optionHeight),e.optionHeight),r=i(n);r!==k.value&&o("scrollInto",e.options[r]),p.value=n;const v=Date.now();v-s>xe&&(s=v,m=n)},I=()=>{if(w())return;const g=p.value-m,n=Date.now()-s;if(n<xe&&Math.abs(g)>vt){l(g,n);return}const v=i(p.value);y.value=we,d(v),setTimeout(()=>{c=!1},0)},S=()=>{const g={height:`${e.optionHeight}px`};return e.options.map((n,r)=>{const v=n[e.fields.text],{disabled:$}=n,U=n[e.fields.value],Be={role:"button",style:g,tabindex:$?-1:0,class:[le("item",{disabled:$,selected:U===e.value}),n.className],onClick:()=>P(r)},Ne={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:v};return h("li",Be,[t.option?t.option(n,r):h("div",Ne,null)])})};return ue($e),Z({stopMomentum:u}),Fe(()=>{const g=c?Math.floor(-p.value/e.optionHeight):e.options.findIndex(v=>v[e.fields.value]===e.value),n=ee(e.options,g),r=-n*e.optionHeight;c&&n<g&&u(),p.value=r}),de("touchmove",T,{target:f}),()=>h("div",{ref:f,class:le(),onTouchstartPassive:D,onTouchend:I,onTouchcancel:I},[h("ul",{ref:C,style:{transform:`translate3d(0, ${p.value+b()}px, 0)`,transitionDuration:`${y.value}ms`,transitionProperty:y.value?"all":"none"},class:le("wrapper"),onTransitionend:u},[S()])])}});const[gt]=H("picker-toolbar"),oe={title:String,cancelButtonText:String,confirmButtonText:String},pt=["cancel","confirm","title","toolbar"],yt=Object.keys(oe);var bt=A({name:gt,props:oe,emits:["confirm","cancel"],setup(e,{emit:o,slots:t}){const c=()=>{if(t.title)return t.title();if(e.title)return h("div",{class:[E("title"),"van-ellipsis"]},[e.title])},a=()=>o("cancel"),s=()=>o("confirm"),m=()=>{var f;const C=(f=e.cancelButtonText)!=null?f:ye("cancel");if(!(!t.cancel&&!C))return h("button",{type:"button",class:[E("cancel"),ce],onClick:a},[t.cancel?t.cancel():C])},x=()=>{var f;const C=(f=e.confirmButtonText)!=null?f:ye("confirm");if(!(!t.confirm&&!C))return h("button",{type:"button",class:[E("confirm"),ce],onClick:s},[t.confirm?t.confirm():C])};return()=>h("div",{class:E("toolbar")},[t.toolbar?t.toolbar():[m(),c(),x()]])}});const[wt,Xt]=H("picker-group"),xt=Symbol(wt);Y({tabs:z(),activeTab:W(0),nextStepText:String,showToolbar:N},oe);const fe=Y({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:W(44),showToolbar:N,swipeDuration:W(1e3),visibleOptionNum:W(6)},oe),kt=Y({},fe,{columns:z(),modelValue:z(),toolbarPosition:Oe("top"),columnsFieldNames:Object});var Ct=A({name:rt,props:kt,emits:["confirm","cancel","change","scrollInto","clickOption","update:modelValue"],setup(e,{emit:o,slots:t}){const c=M(),a=M(e.modelValue.slice(0)),{parent:s}=ue(xt),{children:m,linkChildren:x}=_e($e);x();const f=V(()=>ft(e.columnsFieldNames)),C=V(()=>ze(e.optionHeight)),p=V(()=>ut(e.columns,f.value)),y=V(()=>{const{columns:n}=e;switch(p.value){case"multiple":return n;case"cascade":return dt(n,f.value,a);default:return[n]}}),_=V(()=>y.value.some(n=>n.length)),O=V(()=>y.value.map((n,r)=>re(n,a.value[r],f.value))),b=V(()=>y.value.map((n,r)=>n.findIndex(v=>v[f.value.value]===a.value[r]))),d=(n,r)=>{if(a.value[n]!==r){const v=a.value.slice(0);v[n]=r,a.value=v}},w=()=>({selectedValues:a.value.slice(0),selectedOptions:O.value,selectedIndexes:b.value}),P=(n,r)=>{d(r,n),p.value==="cascade"&&a.value.forEach((v,$)=>{const U=y.value[$];be(U,v,f.value)||d($,U.length?U[0][f.value.value]:void 0)}),ve(()=>{o("change",Y({columnIndex:r},w()))})},i=(n,r)=>{const v={columnIndex:r,currentOption:n};o("clickOption",Y(w(),v)),o("scrollInto",v)},k=()=>{m.forEach(r=>r.stopMomentum());const n=w();return ve(()=>{o("confirm",n)}),n},l=()=>o("cancel",w()),u=()=>y.value.map((n,r)=>h(ht,{value:a.value[r],fields:f.value,options:n,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:C.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:v=>P(v,r),onClickOption:v=>i(v,r),onScrollInto:v=>{o("scrollInto",{currentOption:v,columnIndex:r})}},{option:t.option})),D=n=>{if(_.value){const r={height:`${C.value}px`},v={backgroundSize:`100% ${(n-C.value)/2}px`};return[h("div",{class:E("mask"),style:v},null),h("div",{class:[Ue,E("frame")],style:r},null)]}},T=()=>{const n=C.value*+e.visibleOptionNum,r={height:`${n}px`};return h("div",{ref:c,class:E("columns"),style:r},[u(),D(n)])},I=()=>{if(e.showToolbar&&!s)return h(bt,me(ie(e,yt),{onConfirm:k,onCancel:l}),ie(t,pt))};R(y,n=>{n.forEach((r,v)=>{r.length&&!be(r,a.value[v],f.value)&&d(v,Se(r)[f.value.value])})},{immediate:!0});let S;return R(()=>e.modelValue,n=>{!F(n,a.value)&&!F(n,S)&&(a.value=n.slice(0),S=n.slice(0))},{deep:!0}),R(a,n=>{F(n,e.modelValue)||(S=n.slice(0),o("update:modelValue",S))},{immediate:!0}),de("touchmove",De,{target:c}),Z({confirm:k,getSelectedOptions:()=>O.value}),()=>{var n,r;return h("div",{class:E()},[e.toolbarPosition==="top"?I():null,e.loading?h(Ae,{class:E("loading")},null):null,(n=t["columns-top"])==null?void 0:n.call(t),T(),(r=t["columns-bottom"])==null?void 0:r.call(t),e.toolbarPosition==="bottom"?I():null])}}});const Dt=ne(Ct),Ot=Y({},fe,{modelValue:z(),filter:Function,formatter:{type:Function,default:(e,o)=>o}}),_t=Object.keys(fe);function Tt(e,o){if(e<0)return[];const t=Array(e);let c=-1;for(;++c<e;)t[c]=o(c);return t}const Pt=(e,o)=>32-new Date(e,o-1,32).getDate(),se=(e,o,t,c,a,s)=>{const m=Tt(o-e+1,x=>{const f=Te(e+x);return c(t,{text:f,value:f})});return a?a(t,m,s):m},Mt=(e,o)=>e.map((t,c)=>{const a=o[c];if(a.length){const s=+a[0].value,m=+a[a.length-1].value;return Te(te(+t,s,m))}return t}),ke=new Date().getFullYear(),[Vt]=H("date-picker"),It=Y({},Ot,{columnsType:{type:Array,default:()=>["year","month","day"]},minDate:{type:Date,default:()=>new Date(ke-10,0,1),validator:he},maxDate:{type:Date,default:()=>new Date(ke+10,11,31),validator:he}});var St=A({name:Vt,props:It,emits:["confirm","cancel","change","update:modelValue"],setup(e,{emit:o,slots:t}){const c=M(e.modelValue),a=M(!1),s=M(),m=()=>{const l=e.minDate.getFullYear(),u=e.maxDate.getFullYear();return se(l,u,"year",e.formatter,e.filter)},x=l=>l===e.minDate.getFullYear(),f=l=>l===e.maxDate.getFullYear(),C=l=>l===e.minDate.getMonth()+1,p=l=>l===e.maxDate.getMonth()+1,y=l=>{const{minDate:u,columnsType:D}=e,T=D.indexOf(l),I=a.value?e.modelValue[T]:c.value[T];if(I)return+I;switch(l){case"year":return u.getFullYear();case"month":return u.getMonth()+1;case"day":return u.getDate()}},_=()=>{const l=y("year"),u=x(l)?e.minDate.getMonth()+1:1,D=f(l)?e.maxDate.getMonth()+1:12;return se(u,D,"month",e.formatter,e.filter)},O=()=>{const l=y("year"),u=y("month"),D=x(l)&&C(u)?e.minDate.getDate():1,T=f(l)&&p(u)?e.maxDate.getDate():Pt(l,u);return se(D,T,"day",e.formatter,e.filter)},b=()=>{var l;return(l=s.value)==null?void 0:l.confirm()},d=()=>c.value,w=V(()=>e.columnsType.map(l=>{switch(l){case"year":return m();case"month":return _();case"day":return O();default:throw new Error(`[Vant] DatePicker: unsupported columns type: ${l}`)}}));R(c,l=>{F(l,e.modelValue)||o("update:modelValue",l)}),R(()=>e.modelValue,(l,u)=>{a.value=F(u,c.value),l=Mt(l,w.value),F(l,c.value)||(c.value=l),a.value=!1},{immediate:!0});const P=(...l)=>o("change",...l),i=(...l)=>o("cancel",...l),k=(...l)=>o("confirm",...l);return Z({confirm:b,getSelectedDate:d}),()=>h(Dt,me({ref:s,modelValue:c.value,"onUpdate:modelValue":l=>c.value=l,columns:w.value,onChange:P,onCancel:i,onConfirm:k},ie(e,_t)),t)}});const Et=ne(St),[Ye,J]=H("dropdown-menu"),$t={overlay:N,zIndex:L,duration:W(.2),direction:Oe("down"),activeColor:String,autoLocate:Boolean,closeOnClickOutside:N,closeOnClickOverlay:N,swipeThreshold:L},He=Symbol(Ye);var Yt=A({name:Ye,props:$t,setup(e,{slots:o}){const t=it(),c=M(),a=M(),s=M(0),{children:m,linkChildren:x}=_e(He),f=je(c),C=V(()=>m.some(i=>i.state.showWrapper)),p=V(()=>e.swipeThreshold&&m.length>+e.swipeThreshold),y=V(()=>{if(C.value&&Ce(e.zIndex))return{zIndex:+e.zIndex+1}}),_=()=>{m.forEach(i=>{i.toggle(!1)})},O=()=>{e.closeOnClickOutside&&_()},b=()=>{if(a.value){const i=Pe(a);e.direction==="down"?s.value=i.bottom:s.value=Le.value-i.top}},d=()=>{C.value&&b()},w=i=>{m.forEach((k,l)=>{l===i?k.toggle():k.state.showPopup&&k.toggle(!1,{immediate:!0})})},P=(i,k)=>{const{showPopup:l}=i.state,{disabled:u,titleClass:D}=i;return h("div",{id:`${t}-${k}`,role:"button",tabindex:u?void 0:0,class:[J("item",{disabled:u,grow:p.value}),{[ce]:!u}],onClick:()=>{u||w(k)}},[h("span",{class:[J("title",{down:l===(e.direction==="down"),active:l}),D],style:{color:l?e.activeColor:""}},[h("div",{class:"van-ellipsis"},[i.renderTitle()])])])};return Z({close:_}),x({id:t,props:e,offset:s,updateOffset:b}),Ke(c,O),de("scroll",d,{target:f,passive:!0}),()=>{var i;return h("div",{ref:c,class:J()},[h("div",{ref:a,style:y.value,class:J("bar",{opened:C.value,scrollable:p.value})},[m.map(P)]),(i=o.default)==null?void 0:i.call(o)])}}});const[Ht,X]=H("dropdown-item"),Bt={title:String,options:z(),disabled:Boolean,teleport:[String,Object],lazyRender:N,modelValue:ge,titleClass:ge};var Nt=A({name:Ht,inheritAttrs:!1,props:Bt,emits:["open","opened","close","closed","change","update:modelValue"],setup(e,{emit:o,slots:t,attrs:c}){const a=Me({showPopup:!1,transition:!0,showWrapper:!1}),s=M(),{parent:m,index:x}=ue(He);if(!m){console.error("[Vant] <DropdownItem> must be a child component of <DropdownMenu>.");return}const f=i=>()=>o(i),C=f("open"),p=f("close"),y=f("opened"),_=()=>{a.showWrapper=!1,o("closed")},O=i=>{e.teleport&&i.stopPropagation()},b=(i=!a.showPopup,k={})=>{i!==a.showPopup&&(a.showPopup=i,a.transition=!k.immediate,i&&(m.updateOffset(),a.showWrapper=!0))},d=()=>{if(t.title)return t.title();if(e.title)return e.title;const i=e.options.find(k=>k.value===e.modelValue);return i?i.text:""},w=i=>{const{activeColor:k}=m.props,{disabled:l}=i,u=i.value===e.modelValue,D=()=>{l||(a.showPopup=!1,i.value!==e.modelValue&&(o("update:modelValue",i.value),o("change",i.value)))},T=()=>{if(u)return h(Ie,{class:X("icon"),color:l?void 0:k,name:"success"},null)};return h(ct,{role:"menuitem",key:String(i.value),icon:i.icon,title:i.text,class:X("option",{active:u,disabled:l}),style:{color:u?k:""},tabindex:u?0:-1,clickable:!l,onClick:D},{value:T})},P=()=>{const{offset:i}=m,{autoLocate:k,zIndex:l,overlay:u,duration:D,direction:T,closeOnClickOverlay:I}=m.props,S=Ze(l);let g=i.value;if(k&&s.value){const n=qe(s.value);n&&(g-=Pe(n).top)}return T==="down"?S.top=`${g}px`:S.bottom=`${g}px`,Ge(h("div",me({ref:s,style:S,class:X([T]),onClick:O},c),[h(Ve,{show:a.showPopup,"onUpdate:show":n=>a.showPopup=n,role:"menu",class:X("content"),overlay:u,position:T==="down"?"top":"bottom",duration:a.transition?D:0,lazyRender:e.lazyRender,overlayStyle:{position:"absolute"},"aria-labelledby":`${m.id}-${x.value}`,closeOnClickOverlay:I,onOpen:C,onClose:p,onOpened:y,onClosed:_},{default:()=>{var n;return[e.options.map(w),(n=t.default)==null?void 0:n.call(t)]}})]),[[Qe,a.showWrapper]])};return Z({state:a,toggle:b,renderTitle:d}),()=>e.teleport?h(We,{to:e.teleport},{default:()=>[P()]}):P()}});const Rt=ne(Nt),Ft=ne(Yt),zt={class:"picker"},At={class:"tbar fxi"},Ut={class:"ipts fxi"},jt=["onClick"],Kt={key:0,class:"plhd"},Lt={key:1},Wt={__name:"DatePicker",props:{modelValue:{},modelModifiers:{}},emits:Xe(["change"],["update:modelValue"]),setup(e,{emit:o}){const{t}=et(),c=tt(e,"modelValue"),a=ae().format("YYYY/MM/DD"),s=Me({time:0,show:!1,date:[],idx:0}),m=new Date(ae().subtract(1,"year")),x=new Date,f=o,C=[{text:t("common.today"),value:0},{text:t("common.yesterday"),value:1},{text:t("common.lastxdays",{day:3}),value:2},{text:t("common.lastxdays",{day:7}),value:6},{text:t("common.lastxdays",{day:30}),value:29},{text:t("common.customize"),value:-1}];R(c,p,{immediate:!0});function p([b,d]){s.date=[b==null?void 0:b.split("/"),d==null?void 0:d.split("/")];let w=[0,1,2,6,29].find(P=>O(a,P)===b);w=w===1?O(a,1)===d?1:void 0:w,s.time=w===1?1:a===d&&w!==void 0?w:-1}function y(b,d){if(s.time===-1||d)return s.time===-1&&d&&(s.show=!0);c.value=[O(a,b),O(a,b===1?1:0)],f("change")}function _(b){b?(c.value=s.date.map(d=>d.join("/")),f("change")):p(c.value),s.idx=0,s.show=!1}function O(b,d){return ae(b).subtract(d,"day").format("YYYY/MM/DD")}return(b,d)=>{const w=Rt,P=Ft,i=Ie,k=Et,l=Ve;return G(),Q("div",zt,[h(P,{"close-on-click-outside":!1,"close-on-click-overlay":!1},{default:pe(()=>[nt(b.$slots,"default",{},void 0,!0),h(w,{modelValue:s.time,"onUpdate:modelValue":d[0]||(d[0]=u=>s.time=u),options:C,onChange:y,onClick:d[1]||(d[1]=u=>y("",1))},null,8,["modelValue"])]),_:3}),h(l,{show:s.show,"onUpdate:show":d[5]||(d[5]=u=>s.show=u),position:"bottom","close-on-click-overlay":!1},{default:pe(()=>[j("div",At,[j("p",{class:"back",onClick:d[2]||(d[2]=u=>_(0))},K(B(t)("operate.cancel")),1),ot(" "+K(B(t)("common.ctz_date"))+" ",1),j("p",{class:"confirm",onClick:d[3]||(d[3]=u=>_(1))},K(B(t)("operate.confirm")),1)]),j("ul",Ut,[(G(),Q(at,null,lt(2,(u,D)=>j("li",{key:D,onClick:T=>s.idx=D,class:st(["fxi",s.idx==D&&"act"])},[s.date[D]?(G(),Q("i",Lt,K(s.date[D].join("/")),1)):(G(),Q("p",Kt,K(B(t)("common.slct_date")),1)),h(i,{name:"play"})],10,jt)),64))]),h(k,{modelValue:s.date[s.idx],"onUpdate:modelValue":d[4]||(d[4]=u=>s.date[s.idx]=u),"show-toolbar":!1,"min-date":B(m),"max-date":B(x)},null,8,["modelValue","min-date","max-date"])]),_:1},8,["show"])])}}},en=Je(Wt,[["__scopeId","data-v-877fe5b5"],["__file","C:/code/xx/kc-mobile-v2/src/components/DatePicker.vue"]]);export{Rt as D,en as _};
